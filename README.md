## API网关设计
[toc]

### （一）接口性能统计服务
**模块：apigateway-performance-collection** 

**模块简介：**
该模块实现了接口性能统计的功能，统计涵盖所有RPC接口与REST接口。该性能统计服务每分钟就会统计这一分钟内所有被调用接口的调用次数与平均响应时长，并打印到进程的日志里。

**设计细节：**
- 接口性能统计服务中有三个角色：业务线程，定时器和计算节点。
- 业务线程会把接口调用的记录提交给相应的计算节点来处理。
- 定时器每分钟会向所有的计算节点提交打印和重置任务，计算节点收到任务后会将这一分钟内所有被调用接口的性能统计数据打印到日志中，然后清空内存中所有的统计数据并重新开始统计。
- 在设计上，首先对接口统计数据进行了分片，一个计算节点负责一个分片的统计任务以及打印与重置的任务。计算节点内部持有一个线程，通过单线程串行消费任务的方式避免了同一个接口数据被并发统计带来的问题。
- 整个服务的并发度就是计算节点的个数，这个可以由用户自行配置，默认值为2。


### （二）泛化调用网关
**模块：apigateway-rpc-genericinvoke**

**模块简介：**
该模块实现了泛化调用网关。网关对外提供一个REST接口，客户端通过调用该REST接口就能调用RPC服务方提供的所有RPC接口。
API文档详见 apigateway-rpc-genericinvoke模块下的README.md

**设计细节：**
- 泛化调用网关的设计很简单，在dubbo提供的RPC泛化调用接口上做了一层包装。

### （三）限流功能
**模块：apigateway-flowlimit**



